<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Главная</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <style>
        /* Стили для верхней панели */
        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 20px;
            background: #333;
            color: white;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
        }
        .auth-buttons button {
            margin-left: 10px;
            padding: 5px 10px;
            cursor: pointer;
        }
        /* Стили для редактируемого блока */
        #editable-container {
            margin-top: 80px;
            padding: 20px;
            border: 2px dashed gray;
            min-height: 150px;
            text-align: center;
        }
        #editable-container img {
            max-width: 100%;
            max-height: 200px;
        }
        /* Кнопка сохранения */
        #save-button {
            display: none;
            position: fixed;
            top: 10px;
            right: 10px;
            padding: 10px;
            background: green;
            color: white;
            cursor: pointer;
            border: none;
        }
    </style>
</head>
<body>

    <!-- Верхняя панель -->
    <div class="top-bar">
        <div class="user-info">Гость</div>
        <div class="auth-buttons">
            <button onclick="showPopup('login-popup')">Войти</button>
            <button onclick="showPopup('register-popup')">Регистрация</button>
            <button onclick="logout()" style="display: none;">Выйти</button>
            <button onclick="showPopup('change-password-popup')" style="display: none;">Сменить пароль</button>
            <button id="save-button" onclick="saveContent()">Сохранить</button>
        </div>
    </div>

    <!-- Поле для редактирования -->
    <div id="editable-container" contenteditable="false" ondrop="handleDrop(event)" ondragover="event.preventDefault()">
        <p>Перетащите сюда изображение или текст</p>
    </div>

    <script>
        const SECRET_KEY = "my_secret_key";
        const ADMIN_USER = "5zc8734t6zt856tzc83427b6trriw3r23ut0845uhtv7trhv56znvt9z8ß7qz904t8758te56wbueutwuew4r85uctz0rui09r1285rmcx90m23t90uf5rrmz492mu8fzm824z5ju";

        function encrypt(text) {
            return CryptoJS.AES.encrypt(text, SECRET_KEY).toString();
        }

        function decrypt(text) {
            try {
                return CryptoJS.AES.decrypt(text, SECRET_KEY).toString(CryptoJS.enc.Utf8);
            } catch {
                return null;
            }
        }

        function showPopup(id) {
            document.getElementById(id).style.display = "block";
        }

        function closePopup(id) {
            document.getElementById(id).style.display = "none";
        }

        function login() {
            let username = prompt("Введите имя пользователя:");
            let password = prompt("Введите пароль:");

            let users = JSON.parse(localStorage.getItem("users") || "{}");
            if (!users[username] || decrypt(users[username]) !== password) {
                alert("Неверное имя пользователя или пароль!");
                return;
            }

            localStorage.setItem("loggedUser", username);
            updateUI();
        }

        function logout() {
            localStorage.removeItem("loggedUser");
            updateUI();
        }

        function updateUI() {
            let username = localStorage.getItem("loggedUser");
            let userInfo = document.querySelector(".user-info");
            let saveButton = document.getElementById("save-button");
            let editableContainer = document.getElementById("editable-container");

            if (username) {
                userInfo.textContent = `Вы вошли как ${username}`;
                if (username === ADMIN_USER) {
                    editableContainer.contentEditable = "true";
                    saveButton.style.display = "block";
                } else {
                    editableContainer.contentEditable = "false";
                    saveButton.style.display = "none";
                }
            } else {
                userInfo.textContent = "Гость";
                editableContainer.contentEditable = "false";
                saveButton.style.display = "none";
            }

            // Загружаем сохранённый контент
            let savedContent = localStorage.getItem("editableContent");
            if (savedContent) {
                editableContainer.innerHTML = savedContent;
            }
        }

        function saveContent() {
            let editableContainer = document.getElementById("editable-container");
            localStorage.setItem("editableContent", editableContainer.innerHTML);
            alert("Сохранено!");
        }

        function handleDrop(event) {
            event.preventDefault();
            let files = event.dataTransfer.files;
            if (files.length > 0) {
                let file = files[0];
                let reader = new FileReader();
                reader.onload = function(e) {
                    let img = document.createElement("img");
                    img.src = e.target.result;
                    document.getElementById("editable-container").appendChild(img);
                    saveContent();
                };
                reader.readAsDataURL(file);
            }
        }

        updateUI();
    </script>

</body>
</html>
